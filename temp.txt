
        requestAnimationFrame(() => {
            textEl.style.transform = `translateY(-30px)`;
            textEl.style.opacity = '0';
        });

        setTimeout(() => textEl.remove(), 600);
    }

    function showShop() {
        const itemsContainer = document.getElementById('items-container');
        itemsContainer.innerHTML = '';

        const sortedKeys = Object.keys(ITEMS).sort((a, b) => {
            const typeOrder = { 'attack': 1, 'magic': 2, 'defense': 3, 'special': 4 };
            const typeA = ITEMS[a].type || 'special';
            const typeB = ITEMS[b].type || 'special';
            if (typeOrder[typeA] !== typeOrder[typeB]) {
                return typeOrder[typeA] - typeOrder[typeB];
            }
            return 0;
        });

        for (const key of sortedKeys) {
            const item = ITEMS[key];
            const canAfford = gameState.player.gold >= item.cost;
            const itemEl = document.createElement('div');
            itemEl.className = `item${canAfford ? '' : ' disabled'}`;
            itemEl.innerHTML = `
                <h4>${item.name}</h4>
                <p class="item-desc">${item.description}</p>
                <p>???${item.cost} ??</p>
            `;
            if (canAfford) {
                itemEl.onclick = () => buyItem(item);
            }
            itemsContainer.appendChild(itemEl);
        }
        shopModal.classList.remove('hidden');
    }

    function hideShop() {
        if (!shopModal) return;
        shopModal.classList.add('hidden');
    }

    function buyItem(item) {
        if (gameState.player.gold >= item.cost) {
            gameState.player.gold -= item.cost;
            gameState.player.hero.equipItem(item);
            if (item.effects.buffMinions) {
                gameState.units.filter(u => u.team === gameState.playerTeam && !u.isHero).forEach(minion => minion.recalculateStats());
            }
            updateUI();
            hideShop();
        }
    }

    function aiBuyItem(aiPlayer) {
        if (aiPlayer.gold < 100) return;
